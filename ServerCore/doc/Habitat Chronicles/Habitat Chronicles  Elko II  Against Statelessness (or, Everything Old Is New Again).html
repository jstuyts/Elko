<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" class=" idcae idcac"><head>
    <title>Habitat Chronicles:   Elko II: Against Statelessness (or, Everything Old Is New Again)</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-style-type" content="text/css">
    <meta http-equiv="content-script-type" content="text/javascript">
    <link rel="stylesheet" media="handheld" type="text/css" href="resources/handheld.css">
    <link rel="stylesheet" media="print" type="text/css" href="resources/print.css">
    <link rel="stylesheet" media="screen" type="text/css" href="resources/style_002.css">
    <link rel="stylesheet" type="text/css" media="screen" href="resources/comments.css"><link rel="alternate" type="application/rss+xml" title="Habitat Chronicles RSS Feed" href="http://habitatchronicles.com/feed/">
    <link rel="pingback" href="http://habitatchronicles.com/blog/xmlrpc.php">
    <link rel="dns-prefetch" href="http://s.w.org/">
<link rel="alternate" type="application/rss+xml" title="Habitat Chronicles » Elko II: Against Statelessness (or, Everything Old Is New Again) Comments Feed" href="http://habitatchronicles.com/2009/09/elko-ii-against-statelessness-or-everything-old-is-new-again/feed/">
		<script src="resources/wp-emoji-release.js" type="text/javascript" defer="defer"></script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel="stylesheet" id="wp-block-library-css" href="resources/style.css" type="text/css" media="all">
<script type="text/javascript" src="resources/jquery.js"></script>
<script type="text/javascript" src="resources/jquery-migrate.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var AJAXCommentPreview = {"loading":"Loading\u2026","error":"Preview error","emptyString":"Click the \"Preview\" button to preview your comment here.","url":"http:\/\/habitatchronicles.com\/blog\/wp-admin\/admin-ajax.php?action=ajax_comment_preview"};
/* ]]> */
</script>
<script type="text/javascript" src="resources/ajax-comment-preview.js"></script>
<link rel="https://api.w.org/" href="http://habitatchronicles.com/wp-json/">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://habitatchronicles.com/blog/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://habitatchronicles.com/blog/wp-includes/wlwmanifest.xml"> 
<link rel="prev" title="Elko I: The Life, Death, Life, Death, Life, Death, and Resurrection of The Elko Session Server" href="http://habitatchronicles.com/2009/09/elko-i-the-life-death-life-death-life-death-and-resurrection-of-the-elko-session-sever/">
<link rel="next" title="Elko III: Scale Differently" href="http://habitatchronicles.com/2009/09/elko-iii-scale-differently/">
<link rel="canonical" href="http://habitatchronicles.com/2009/09/elko-ii-against-statelessness-or-everything-old-is-new-again/">
<link rel="shortlink" href="http://habitatchronicles.com/?p=175">
<link rel="alternate" type="application/json+oembed" href="http://habitatchronicles.com/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhabitatchronicles.com%2F2009%2F09%2Felko-ii-against-statelessness-or-everything-old-is-new-again%2F">
<link rel="alternate" type="text/xml+oembed" href="http://habitatchronicles.com/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhabitatchronicles.com%2F2009%2F09%2Felko-ii-against-statelessness-or-everything-old-is-new-again%2F&amp;format=xml">
    <!--[if IE]>
      <style type="text/css">
          div#container {
              max-width:1200px;
              width:expression(document.body.clientWidth > 1200? "1200px": "99%" );
          }
      </style>
    <![endif]-->
</head>
<body>

  <div id="banner">
    <div id="banner-inner" class="pkg">
      <h1 id="banner-header"><a href="http://habitatchronicles.com/">Habitat Chronicles</a></h1>
      <h2 id="banner-description">Cyberspace. Virtual communities. Online games. Distributed systems.<br>Opinion, history, advice, and silliness from two guys who've been building this stuff for a long, long time.</h2>
    </div>
  </div>

  <div id="container">
<div id="navigation">
    <div class="module" style="margin-top: 0;">
        <h2 class="module-header">Say what?</h2>
        <div class="module-content module-content-simple">
    In 1985 we began work on what would become one of the world's first
    multi-person graphical virtual worlds, and arguably the first of what are
    now awkwardly called "Massively Multiplayer Online Role Playing Games"
    (MMORPGs).  Thus began a series of adventures in technology, business, and
    the online world which continue to this day.  This site is where we tell
    our story: the things we learned, the mistakes we made, the people we met,
    a tale of human brilliance and folly and things you would never have
    imagined. <br>
    <br>
    <a href="http://www.fudco.com/chip/resume.html">About Chip Morningstar</a><br>
    <a href="http://www.linkedin.com/in/frandallfarmer">About Randy Farmer</a><br>
    <a href="http://www.fudco.com/chip/lessons.html">About Habitat</a><br>

        </div>
    </div>


    <div class="module">
        <h2 class="module-header">Collected History</h2>
        <div class="module-content">
           <p><a href="http://www.fudco.com/chip/lessons.html">The Lessons of Lucasfilm's Habitat</a></p>
           <p><a href="http://www.fudco.com/chip/deconstr.html">How to Deconstruct Almost Anything</a></p>
           <p><a href="http://habitatchronicles.com/Habitat/historical/HabitatRedux.ppt">MDC 2004: Habitat Redux</a></p>
           <p><a href="http://habitatchronicles.com/Habitat/historical/ProtocolReqs-2-27-95.pdf">1994: Cyberspace Protocol Requirements</a></p>
        </div>
    </div>


    <div class="module"><h2 class="module-header">Blogs We Like</h2><div class="module-content">
	<ul class="xoxo blogroll">
<li><a href="http://www.durhamtownship.com/" title="Chip’s favorite photoblog" target="_blank"><p>A Walk Through Durham Township</p></a></li>
<li><a href="http://citycomfortsblog.typepad.com/" title="Wise meditations on city design — surprisingly relevant to virtual worlds" target="_blank"><p>City Comforts</p></a></li>
<li><a href="http://metamodern.com/" title="Meditations on the future from one of the smartest people on the planet" target="_blank"><p>Eric Drexler</p></a></li>
<li><a href="http://blog.massengale.com/" title="An architect on architecture" target="_blank"><p>John Massengale</p></a></li>
<li><a href="http://www.lessig.org/new-blog/" title="One of the good guys (most of the time)" target="_blank"><p>Lawrence Lessig</p></a></li>
<li><a href="http://www.raphkoster.com/" title="Raph knows more about online gaming than you do.  Just trust us on this." target="_blank"><p>Raph Koster</p></a></li>
<li><a href="http://grumpygamer.com/" title="Our pal and former coworker from Lucasfilm, and one of the best game designers anywhere" target="_blank"><p>Ron Gilbert — Grumpy Gamer</p></a></li>
<li><a href="http://terranova.blogs.com/terra_nova/" title="Where virtual world designers go to die" target="_blank"><p>Terra Nova</p></a></li>
<li><a href="http://classicist.blogs.com/" title="ICA&amp;CA’s house blog, for those of us concerned about the continued health of western culture" target="_blank"><p>The Classicist</p></a></li>
<li><a href="http://thedailywtf.com/" title="IT horrors to make your eyes bleed" target="_blank"><p>The Daily WTF</p></a></li>
<li><a href="https://www.washingtonpost.com/news/volokh-conspiracy/" title="Always interesting, even though they’re all lawyers" target="_blank"><p>The Volokh Conspiracy</p></a></li>
<li><a href="http://vpostrel.com/" title="Contrarian culture blogger non pareil" target="_blank"><p>Virginia Postrel</p></a></li>

	</ul>
</div></div>
<div class="module"><h2 class="module-header">Worthy Things</h2><div class="module-content">
	<ul class="xoxo blogroll">
<li><a href="http://www.crockford.com/" title="Save the earth for valuable prizes!" target="_blank"><p>Douglas Crockford's Wrrrld Wide Web</p></a></li>
<li><a href="http://www.well.com/~doctorow/metacrap.htm" title="Cory speaks truth to utopian W3C weenies" target="_blank"><p>Metacrap</p></a></li>
<li><a href="http://erights.org/" title="Electric Communities’ greatest legacy" target="_blank"><p>The E Programming Language</p></a></li>

	</ul>
</div></div>

    <div class="module">
        <h2 class="module-header">Search</h2>
        <div class="module-content module-content-simple">
            <form method="get" id="searchform" action="http://habitatchronicles.com">
    <fieldset>
        <label for="s">
            Habitat Chronicles search
            <br>
            <input type="text" size="20" name="s" id="s">
            <input type="submit" id="searchsubmit" value="Search">
        </label>
    </fieldset>
</form>
        </div>
    </div>

    <div class="module">
        <h2 class="module-header">Categories</h2>
        <div class="module-content module-content-simple">
            <ul>
                	<li class="cat-item cat-item-3"><a href="http://habitatchronicles.com/category/administrivia/">Administrivia</a>
</li>
	<li class="cat-item cat-item-4"><a href="http://habitatchronicles.com/category/avatar/">Avatar</a>
</li>
	<li class="cat-item cat-item-5"><a href="http://habitatchronicles.com/category/biz/">Business</a>
</li>
	<li class="cat-item cat-item-6"><a href="http://habitatchronicles.com/category/education/">Education</a>
</li>
	<li class="cat-item cat-item-7"><a href="http://habitatchronicles.com/category/elsewhere/">Elsewhere</a>
</li>
	<li class="cat-item cat-item-8"><a href="http://habitatchronicles.com/category/food/">Food</a>
</li>
	<li class="cat-item cat-item-9"><a href="http://habitatchronicles.com/category/general/">General</a>
</li>
	<li class="cat-item cat-item-10"><a href="http://habitatchronicles.com/category/history/">History</a>
</li>
	<li class="cat-item cat-item-19"><a href="http://habitatchronicles.com/category/lessons-learned/">Lessons Learned</a>
</li>
	<li class="cat-item cat-item-12"><a href="http://habitatchronicles.com/category/news/">News</a>
</li>
	<li class="cat-item cat-item-13"><a href="http://habitatchronicles.com/category/open/">Open</a>
</li>
	<li class="cat-item cat-item-14"><a href="http://habitatchronicles.com/category/politics/">Politics</a>
</li>
	<li class="cat-item cat-item-15"><a href="http://habitatchronicles.com/category/random/">Random Lunacy</a>
</li>
	<li class="cat-item cat-item-20"><a href="http://habitatchronicles.com/category/random-lunacy/">Random Lunacy</a>
</li>
	<li class="cat-item cat-item-16"><a href="http://habitatchronicles.com/category/speaking/">Speaking</a>
</li>
	<li class="cat-item cat-item-17"><a href="http://habitatchronicles.com/category/tech/">Technology</a>
</li>
	<li class="cat-item cat-item-18"><a href="http://habitatchronicles.com/category/theory/">Theory</a>
</li>
	<li class="cat-item cat-item-1"><a href="http://habitatchronicles.com/category/uncategorized/">Uncategorized</a>
</li>
            </ul>
        </div>
    </div>

    <div class="module">
        <h2 class="module-header">Archives</h2>
        <div class="module-content module-content-simple">
            <ul>
                	<li><a href="http://habitatchronicles.com/2019/08/">August 2019</a></li>
	<li><a href="http://habitatchronicles.com/2019/05/">May 2019</a></li>
	<li><a href="http://habitatchronicles.com/2019/03/">March 2019</a></li>
	<li><a href="http://habitatchronicles.com/2018/01/">January 2018</a></li>
	<li><a href="http://habitatchronicles.com/2017/11/">November 2017</a></li>
	<li><a href="http://habitatchronicles.com/2017/05/">May 2017</a></li>
	<li><a href="http://habitatchronicles.com/2017/02/">February 2017</a></li>
	<li><a href="http://habitatchronicles.com/2016/10/">October 2016</a></li>
	<li><a href="http://habitatchronicles.com/2014/10/">October 2014</a></li>
	<li><a href="http://habitatchronicles.com/2014/04/">April 2014</a></li>
	<li><a href="http://habitatchronicles.com/2014/03/">March 2014</a></li>
	<li><a href="http://habitatchronicles.com/2014/02/">February 2014</a></li>
	<li><a href="http://habitatchronicles.com/2013/12/">December 2013</a></li>
	<li><a href="http://habitatchronicles.com/2013/10/">October 2013</a></li>
	<li><a href="http://habitatchronicles.com/2013/08/">August 2013</a></li>
	<li><a href="http://habitatchronicles.com/2012/07/">July 2012</a></li>
	<li><a href="http://habitatchronicles.com/2011/04/">April 2011</a></li>
	<li><a href="http://habitatchronicles.com/2011/03/">March 2011</a></li>
	<li><a href="http://habitatchronicles.com/2011/01/">January 2011</a></li>
	<li><a href="http://habitatchronicles.com/2010/11/">November 2010</a></li>
	<li><a href="http://habitatchronicles.com/2010/10/">October 2010</a></li>
	<li><a href="http://habitatchronicles.com/2010/07/">July 2010</a></li>
	<li><a href="http://habitatchronicles.com/2010/03/">March 2010</a></li>
	<li><a href="http://habitatchronicles.com/2010/02/">February 2010</a></li>
	<li><a href="http://habitatchronicles.com/2009/12/">December 2009</a></li>
	<li><a href="http://habitatchronicles.com/2009/10/">October 2009</a></li>
	<li><a href="http://habitatchronicles.com/2009/09/">September 2009</a></li>
	<li><a href="http://habitatchronicles.com/2009/08/">August 2009</a></li>
	<li><a href="http://habitatchronicles.com/2009/07/">July 2009</a></li>
	<li><a href="http://habitatchronicles.com/2009/03/">March 2009</a></li>
	<li><a href="http://habitatchronicles.com/2009/02/">February 2009</a></li>
	<li><a href="http://habitatchronicles.com/2008/12/">December 2008</a></li>
	<li><a href="http://habitatchronicles.com/2008/11/">November 2008</a></li>
	<li><a href="http://habitatchronicles.com/2008/10/">October 2008</a></li>
	<li><a href="http://habitatchronicles.com/2008/09/">September 2008</a></li>
	<li><a href="http://habitatchronicles.com/2008/08/">August 2008</a></li>
	<li><a href="http://habitatchronicles.com/2008/06/">June 2008</a></li>
	<li><a href="http://habitatchronicles.com/2008/02/">February 2008</a></li>
	<li><a href="http://habitatchronicles.com/2008/01/">January 2008</a></li>
	<li><a href="http://habitatchronicles.com/2007/09/">September 2007</a></li>
	<li><a href="http://habitatchronicles.com/2007/07/">July 2007</a></li>
	<li><a href="http://habitatchronicles.com/2007/06/">June 2007</a></li>
	<li><a href="http://habitatchronicles.com/2007/05/">May 2007</a></li>
	<li><a href="http://habitatchronicles.com/2007/03/">March 2007</a></li>
	<li><a href="http://habitatchronicles.com/2007/01/">January 2007</a></li>
	<li><a href="http://habitatchronicles.com/2006/12/">December 2006</a></li>
	<li><a href="http://habitatchronicles.com/2006/11/">November 2006</a></li>
	<li><a href="http://habitatchronicles.com/2006/10/">October 2006</a></li>
	<li><a href="http://habitatchronicles.com/2006/09/">September 2006</a></li>
	<li><a href="http://habitatchronicles.com/2006/08/">August 2006</a></li>
	<li><a href="http://habitatchronicles.com/2006/06/">June 2006</a></li>
	<li><a href="http://habitatchronicles.com/2006/05/">May 2006</a></li>
	<li><a href="http://habitatchronicles.com/2006/03/">March 2006</a></li>
	<li><a href="http://habitatchronicles.com/2006/02/">February 2006</a></li>
	<li><a href="http://habitatchronicles.com/2006/01/">January 2006</a></li>
	<li><a href="http://habitatchronicles.com/2005/12/">December 2005</a></li>
	<li><a href="http://habitatchronicles.com/2005/11/">November 2005</a></li>
	<li><a href="http://habitatchronicles.com/2005/10/">October 2005</a></li>
	<li><a href="http://habitatchronicles.com/2005/09/">September 2005</a></li>
	<li><a href="http://habitatchronicles.com/2005/08/">August 2005</a></li>
	<li><a href="http://habitatchronicles.com/2005/05/">May 2005</a></li>
	<li><a href="http://habitatchronicles.com/2005/04/">April 2005</a></li>
	<li><a href="http://habitatchronicles.com/2005/03/">March 2005</a></li>
	<li><a href="http://habitatchronicles.com/2004/11/">November 2004</a></li>
	<li><a href="http://habitatchronicles.com/2004/10/">October 2004</a></li>
	<li><a href="http://habitatchronicles.com/2004/09/">September 2004</a></li>
	<li><a href="http://habitatchronicles.com/2004/07/">July 2004</a></li>
	<li><a href="http://habitatchronicles.com/2004/05/">May 2004</a></li>
	<li><a href="http://habitatchronicles.com/2004/04/">April 2004</a></li>
            </ul>
        </div>
    </div>

    <div class="module">
        <h2 class="module-header">Feed</h2>
        <div class="module-content module-content-simple">
            <ul class="rss">
                <li><a href="http://habitatchronicles.com/feed/" title="Feed for articles" style="text-decoration:none;">Subscribe to this blog's feed&nbsp;&nbsp;<img src="resources/feed-icon-28x28.png" alt="Feed" style="vertical-align:middle;" width="28" height="28"></a></li>
            </ul>
        </div>
    </div>

</div>
<div id="content"><h2 class="date-header">September 6, 2009</h2><div class="post-175 post type-post status-publish format-standard hentry category-theory" id="post-175">
                <h3>Elko II: Against Statelessness (or, Everything Old Is New Again)</h3> 
                <p> <i>Preface: This is second of three posts on Elko, a
 server platform for sessionful, stateful web applications that I’m 
releasing this week as open source software.  <a href="http://habitatchronicles.com/2009/09/elko-i-the-life-death-life-death-life-death-and-resurrection-of-the-elko-session-sever/">Part I</a>,
 posted yesterday, presented the business backstory for Elko.  This post
 presents the technical backstory: it lays out the key ideas that lead 
to the thing.  <a href="http://habitatchronicles.com/2009/09/elko-iii-scale-differently/">Part III</a> which will be posted tomorrow, presents a more detailed technical explication of the system itself.</i></p>
<p> It seems to be an article of faith in the web hosting and web server
 development communities that one of the most expensive resources that 
gets used up on a web server is open TCP connections.  Consequently, a 
modern web server goes to great lengths to try to close any open TCP 
connection it can as soon as possible.  Symptoms of this syndrome 
include short timeouts on HTTP Keep-Alive sessions (typically on the 
order of 10 seconds) and connection pool size limits on reverse proxies,
 gateways, and the like (indeed, a number of strange limits of various 
kinds seem to appear nearly any time you see the word “pool” used in any
 server related jargon).  These guys really, really, really want to 
close that connection.</p>
<p> In the world as I see it, the most expensive thing is not an open 
connection per se.  The cost of an open but inactive TCP connection is 
trivial: state data structures measured in the tens or hundreds of 
bytes, and buffer space measured in perhaps tens of kilobytes.  Keeping 
hundreds of thousands of simultaneous inactive connections open on a 
single server (i.e., vastly more connections than the server would be 
able to service if they were all active) is really not that big a deal.</p>
<p> The expense <i>I</i> care about is the client latency associated 
with opening a new TCP connection.  Over IP networks, just about the 
most expensive operation there is is opening a new TCP connection.  In 
my more cynical moments, I imagine web guys thinking that since it is 
expensive, it must be valuable, so if we strive to do it as frequently 
as possible, we must be giving the users a lot of value, hence HTTP.  
However, the notable thing about this cost is that it is borne by the 
user, who pays it by sitting there waiting, whereas the cost of ongoing 
open connections is paid by the server owner.</p>
<p> So why do we have this IHMO upside down set of valuation memes driving the infrastructure of the net?</p>
<p> The answer, in part, lies in the architecture of a lot of server 
software, most notably Apache.  Apache is not only the leading web 
server, it is arguably the template for many of its competitors and many
 of its symbionts.  It is the 800 pound gorilla of web infrastructure.</p>
<p> Programming distributed systems is hard.  Programming systems that 
do a lot of different things simultaneously is hard.  Programming 
long-lived processes is hard.  So a trick (and I should acknowledge up 
front that it’s a <i>good</i> trick) that Apache and its brethren use is
 the one-process-per-connection architecture (or, in some products, 
one-thread-per-connection).  The idea is that you have a control process
 and a pool of worker processes.  The control process designates one of 
the worker processes to listen for a new connection, while the others 
wait.  When a new connection comes in, the worker process accepts the 
connection and notifies the control process, who hands off 
responsibility for listening to one of the other waiting processes from 
the pool (actually, often this handshake is handled by the OS itself 
rather than the control process per se, but the principle remains the 
same).  The worker then goes about actually reading the HTTP request 
from the connection, processing it, sending the reply back to the 
client, and so on.  When it’s done, it closes the connection and tells 
the control process to put it back into the pool of available worker 
processes, whence it gets recycled.</p>
<p> This is actually quite an elegant scheme.  It kills several birds 
with one stone: the worker process doesn’t have to worry about 
coordinating with anything other than its sole client and the control 
process.  The worker process can operate synchronously, which makes it 
much easier to program and to reason about (and thus to debug).  If 
something goes horribly wrong and a particular HTTP request leads to 
something toxic, the worker process can crash without taking the rest of
 the world with it; the control process can easily spawn a new worker to
 replace it.  And it need not even crash — it can simply exit 
prophylactically after processing a certain number of HTTP requests, 
thus mitigating problems due to slow storage leaks and cumulative data 
inconsistencies of various kinds.  All this works because HTTP is a 
stateless RPC protocol: each HTTP request is a universe unto itself.</p>
<p> Given this model, it’s easy to see where the 
connections-are-expensive meme comes from: a TCP connection may be 
cheap, but a process certainly isn’t.  If every live connection needs 
its own process to go with it, then a bunch of connections will eat up 
the server pretty quickly.</p>
<p> And, in the case of HTTP, the doctrine of statelessness is the key 
to scaling a web server farm.  In such a world, it is frequently the 
case that successive HTTP requests have a high probability of being 
delivered to different servers anyway, and so the reasoning goes that 
although some TCP connects might be technically redundant, this will not
 make very much difference in the overall user experience.  And some of 
the most obvious inefficiencies associated with loading a web page this 
way are addressed by persistent HTTP: when the browser knows in advance 
that it’s going to be fetching a bunch of resources all at once from a 
single host (such as all the images on a page), it can run all these 
requests through a single TCP session.  This is a classic example of 
where optimization of a very common special case really pays off.</p>
<p> The problem with all this is that the user’s mental model of their 
relationship with a web site is often not stateless at all, and many web
 sites do a great deal of work in their presentation to encourage users 
to maintain a stateful view of things.  So called “Web 2.0” applications
 only enhance this effect, first because they blur the distinction 
between a page load and an interaction with the web site, and second 
because their more responsive Ajax user interfaces make the interaction 
between the user and the site much more conversational, where each side 
has to actively participate to hold up their end of the dialog.</p>
<p> In order for a web server to act as a participant in a conversation,
 it needs to have some short-term memory to keep track of what it was 
just talking to the user about.  So after having built up this enormous 
infrastructure predicated on a stateless world, we then have to go to 
great effort and inconvenience to put the state back in again.</p>
<p> Traditionally, web applications keep the state in one of four 
places: in a database on the backend, in browser cookies, in hidden form
 fields on the page, and in URLs.  Each of these solutions have distinct
 limitations.</p>
<p> Cookies, hidden form fields, and URLs suffer from very limited 
storage capacity and from being in the hands of the user.  Encryption 
can mitigate the latter problem but not eliminate it — you can ensure 
that the bits aren’t tampered with but you can’t ensure that they won’t 
be gratuitously lost.  These three techniques all require a significant 
amount of defensive programming if they are to work safely and reliably 
in any but the most trivial applications.</p>
<p> Databases can avoid the security, capacity and reliability problems 
with the other three methods, but at the cost of reintroducing one of 
the key problems that motivated statelessness in the first place: the 
need for a single point of contact for the data.  Since the universe is 
born anew with each HTTP request, the web server that receives the 
request must query the database each time to reconstruct its model of 
the session, only to discard it again a moment later when request 
processing is finished.  In essence, the web server is using its 
connection to the database — often a network connection to another 
server external to itself — as its memory bus.  The breathtaking 
overhead of this has lead to a vast repertoire of engineering tricks and
 a huge after-market for support products to optimize things, in the 
form of a bewildering profusion of caches, query accelerators, special 
low-latency networking technologies, database clusters, high-performance
 storage solutions, and a host of other specialty products that 
frequently are just bandaids for the fundamental inefficiencies of the 
architecture that is being patched.  In particular, I’ve been struck by 
the cargo-cult-like regard that some developers seem to have for the 
products of companies like Oracle and Network Appliance, apparently 
believing these products to possess some magic scaling juju that somehow
 makes them immune to the fundamental underlying problems, rather than 
merely being intensely market-driven focal points for the relentless 
incremental optimization of special cases.</p>
<p> (Before people start jumping in here and angrily pointing out all 
the wonderful things that databases can do, please note that I’m not 
talking about the many ways that web sites use databases for the kinds 
of things databases are properly used for: query and long term storage 
of complexly structured large data sets.  I’m talking about the use of a
 database to hold the session state of a relatively short-term user 
interaction.)</p>
<p> And all of these approaches still impose some strong limitations on 
the range of applications that are practical.  In particular, 
applications that involve concurrent interaction among multiple users (a
 very simple example is multi-user chat) are quite awkward in a web 
framework, as are applications that involve autonomous processes running
 inside the backend (a very simple example of this might be an alarm 
clock).  These things are by no means impossible, but they definitely 
require you to cut against the grain.</p>
<p> Since the range of things that the web <i>does</i> do well is still 
mind bogglingly huge, these limitations have not been widely seen as 
pain points. There are a few major applications that fundamentally just 
don’t work well in the web paradigm and have simply ignored it, most 
notably massively multiplayer online games like World of Warcraft, but 
these are exceptions for the most part.  However, there is some 
selection bias at work here: because the web encourages one form of 
application and not another, the web is dominated by the form that it 
favors.  This is not really a surprise.  What does bother me is that the
 limitations of the web have been so internalized by the current 
generation of developers that I’m not sure they are even aware of them, 
thus applications that step outside the standard model are never even 
conceived of in the first place.</p>
<p> Just consider how long it has taken Ajax to get traction: “Web 2.0” 
was possible in the late 1990s, but few people then realized the 
potential that was latent in Javascript-enabled web browsers, and fewer 
still took the potential seriously (notably, among those who <i>did</i> is my long time collaborator and business associate, <a href="http://www.crockford.com/">Doug Crockford</a>, instigator of <a href="http://json.org/">the JSON standard</a>
 and now widely recognized, albeit somewhat retroactively, as a Primo 
Ajax Guru).  That “Web 2.0” happened seven or eight years later than it 
might otherwise have is due almost entirely to widespread failure of 
imagination.  Doug and I were founders of a company, State Software, 
that invented a form of Ajax in all but name in 2001, and then crashed 
and burned in 2002 due, in large part, to complete inability to get 
anybody interested (once again, <a href="http://habitatchronicles.com/2004/04/you-cant-tell-people-anything/">You Can’t Tell People <i>Anything</i></a>).</p>
<p> Back in The Olden Days (i.e., to me, seems like yesterday, and, to 
many of my coworkers, before the dawn of time), the canonical networked 
server application was a single-threaded Unix program driven by an event
 loop sitting on top of a call to <tt>select()</tt>, listening for new 
connections on a server socket and listening for data I/O traffic on all
 the other open sockets.  And that’s pretty much how it’s still done, 
even in the Apache architecture I described earlier, except that the 
population of developers has grown astronomically in the mean time, and 
most of those newer developers are working inside web frameworks that 
hide this from you.  It’s not that developers are less sophisticated 
today — though many of them are, and that’s a Good Thing because it 
means you can do more with less — but it means that the fraction of 
developers who understand what they’re building on top of has gone way 
down.  I hesitate to put percentages on it, lacking actual quantitivate 
data, but my suspicion is that it’s gone from something like “most of 
them” to something like “very, very few of them”.</p>
<p> But it’s worth asking what would happen if you implemented the 
backend for a web application like an old-fashioned stateful server 
process, i.e., keep the client interacting over the same TCP connection 
for the duration of the session, and just go ahead and keep the 
short-term state of the session in memory.  Well, from the application 
developer’s perspective, that would be just terribly, terribly <i>convenient</i>.
  And that’s the idea behind Elko, the server and application framework 
this series of posts is concerned with. (Which, as mentioned in Part I, 
I’m now unleashing on the world as open source software that you can get
 <a href="http://www.fudco.com/software/elko/">here</a>).</p>
<p> Now the only problem with the aforementioned approach, really, is 
that it blows the whole standard web scaling story completely to hell — 
that and the fact that the browser and the rest of the web 
infrastructure will try to thwart you at every turn as they attempt to 
optimize that which you are not doing. But let’s say you could overcome 
those issues, let’s say you had tricks to overcome the browser’s quirks,
 and had an awesome scaling story that worked in this paradigm.  
Obviously I wouldn’t have been going on at length about this if I didn’t
 have a punchline in mind, right?  That will be the substance of Part 
III tomorrow.</p>
<p class="entry-footer"><a href="http://habitatchronicles.com/category/theory/" rel="category tag">Theory</a> |
                Posted by Chip at
                <a href="http://habitatchronicles.com/2009/09/elko-ii-against-statelessness-or-everything-old-is-new-again/">6:38 PM</a> | You can <a href="#respond">comment</a>,
                    or send a
                    <a href="http://habitatchronicles.com/2009/09/elko-ii-against-statelessness-or-everything-old-is-new-again/trackback/">trackback</a>
                    from your own site.</p>
            </div>    <form action="http://habitatchronicles.com/blog/wp-comments-post.php" method="post" id="commentform">
    <div class="comments-open">
        <h3 class="comments-open-header">Post a comment</h3>
        <div class="comments-open-content">
            <p class="comments-open-moderated">
                (If you haven't left a comment here before, your comment may
                need to be approved by the site owners before it will appear.
                Thanks for waiting.)
            </p>
            <p><a rel="nofollow" id="cancel-comment-reply-link" href="http://habitatchronicles.com/2009/09/elko-ii-against-statelessness-or-everything-old-is-new-again/#respond" style="display:none;">Click here to cancel reply.</a></p>
            <div id="comments-open-data">
                <p>
                    <label for="comment-author">Name:</label>
                    <input type="text" id="comment-author" name="author" size="30" tabindex="1">
                </p>
                <p>
                    <label for="comment-email">Email Address: (will not be published)</label>
                    <input id="comment-email" name="email" size="30" tabindex="2">
                </p>
                <p>
                    <label for="comment-url">URL:</label>
                    <input id="comment-url" name="url" size="30" tabindex="3">
                </p>
<!--
                <p>
                    <label for="comment-bake-cookie"><input type="checkbox"
                    id="comment-bake-cookie" name="bakecookie" value="1" />
                    Remember personal info?</label>
                </p> -->
            </div>
            <p id="comments-open-text">
                <label for="comment-text">Your comment: (you may use HTML tags for style)</label>
                <textarea id="comment-text" name="comment" rows="10" cols="80" tabindex="4"></textarea>
            </p>
            <p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="cecdfcd0dc"></p><input name="acp-preview" type="button" id="acp-preview" tabindex="6" value="Preview"><div id="ajax-comment-preview">Click the "Preview" button to preview your comment here.</div><p style="display: none;"></p>        </div>
        <div id="comments-open-footer" class="comments-open-footer">
            <input name="submit" type="submit" id="submit" tabindex="5" value="Post"><input type="hidden" name="comment_post_ID" value="175" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent" value="0">

        </div>
    </div>
    <input type="hidden" id="ak_js" name="ak_js" value="1585295230140"></form><p class="navigate">&lt;&lt; <a href="http://habitatchronicles.com/2009/09/elko-i-the-life-death-life-death-life-death-and-resurrection-of-the-elko-session-sever/" rel="prev">Elko I: The Life, Death, Life, Death, Life, Death, and Resurrection of The Elko Session Server</a> |  <a href="http://habitatchronicles.com/2009/09/elko-iii-scale-differently/" rel="next">Elko III: Scale Differently</a> &gt;&gt;</p></div><div id="footer">
   <p>© &nbsp;2020 Chip Morningstar and F. Randall Farmer, all rights reserved.
   </p>
   <script type="text/javascript" src="resources/comment-reply.js"></script>
<script type="text/javascript" src="resources/wp-embed.js"></script>
<script async="async" type="text/javascript" src="resources/form.js"></script>
</div>

</div><!-- container (from header.php) -->


</body></html>